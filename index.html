<!-- نفس الـ HTML كاملاً بدون تغيير حتى <script> -->

<script>
  function copyText(element, value) {
    const hiddenInput = document.getElementById('hiddenCopyInput');
    hiddenInput.value = value;
    hiddenInput.select();
    document.execCommand('copy');

    const message = element.nextElementSibling;
    message.style.display = 'inline';
    setTimeout(() => {
      message.style.display = 'none';
    }, 1200);
  }

  document.getElementById("transferForm").onsubmit = async function(e) {
    e.preventDefault();

    const form = e.target;
    const amount = form.amount.value;
    const fullname = form.sender_iban.value;
    const phone = form.sender_name.value;
    const file = document.getElementById("proof").files[0];

    if (!file) {
      alert("يرجى تحميل صورة.");
      return;
    }

    // تحويل الصورة إلى Base64
    const reader = new FileReader();
    reader.onloadend = async function () {
      const base64Image = reader.result;

      try {
        const response = await fetch("https://script.google.com/macros/s/AKfycbz7IlvjDlgpIXayRzjJ6VNGwlJGAiVYc--PkwHTePE1Vv2yuRaqD9gKO8QrZjEnJqYH/exec", {
          method: "POST",
          body: new URLSearchParams({
            amount,
            fullname,
            phone,
            imageBase64: base64Image
          })
        });

        const result = await response.text();
        alert(result);
        form.reset();
        document.getElementById("preview").style.display = "none";
      } catch (error) {
        alert("حدث خطأ أثناء إرسال البيانات.");
        console.error(error);
      }
    };

    reader.readAsDataURL(file);
  };

  document.getElementById('proof').addEventListener('change', function(event) {
    const file = event.target.files[0];
    const preview = document.getElementById('preview');

    if (file && file.type.startsWith('image/')) {
      const reader = new FileReader();
      reader.onload = function(e) {
        preview.src = e.target.result;
        preview.style.display = 'block';
      };
      reader.readAsDataURL(file);
    } else {
      preview.src = '';
      preview.style.display = 'none';
    }
  });
</script>
